# 메모리

>> 메모리는 아주 아주 민감하고 중요한 영역입니다.
>> 메모리의 영역으로는 스택, 힙, 코드 영역, 커널 영역, 
>> 동적 라이브러리 영역 등이 있습니다.

## 커널 영역
>> 커널은 운영체제를 구성하는 Interrupt, System Call 등
>> 매우 중요한 연산을 처리하는 곳입니다. Interrupt나 
>> System Call이 정상적으로 작동하지 않는다면? 
>> 컴퓨터에 이상이 생기게 됩니다.
>> 이 메모리 영역은 실수로 건드리지 않도록 조심해야 합니다.
>> 선형 메모리에 스택, 힙, 코드, 커널, 동적 라이브러리 영역이
>> 모여있기 때문에 잘못 건드리면 Buffer Overflow나 여러가지
>> 문제로 인해 커널 영역이나 다른 영역을 침범하는 보안
>> 오류가 발생할 수 있습니다.

## 스택 영역
>> 스택 영역은 로컬 변수나 함수로 전달받은 
>> 파라미터, 함수의 stack frame pointer 같은 데이터를
>> 담는 영역입니다. 
>> esp, rsp 레지스터로 가리키며, stack base pointer을 가리키는
>> ebp, rbp 레지스터를 통해서 스택의 시작 주소가 어디인지
>> 알 수 있습니다. ebp, rbp 레지스터로 local 변수나
>> 함수의 parameter 등을 참조할 수가 있습니다.

## 힙 영역
>> 힙 영역은 동적으로 할당된 메모리들의 영역입니다.
>> C언어에서는, pointer 변수 하나를 마련한 이후
>> malloc() 함수로 할당받은 공간의 포인터를 받아
>> 사용할 수 있습니다. free()연산을 통해 해당
>> 공간을 사용 해제할 수 있습니다.

## 코드 영역
>> 코드가 존재하는 곳입니다.
>> 스택 / 힙 영역에는 Data를 읽을 수는 있지만, 
>> 실행 권한이 없기 때문에(원래는 가능했지만 보안
>> 취약성때문에 실행권한을 삭제함)
>> 스택이나 힙 영역에 쉘코드를 삽입시켜서 
>> 명령어를 실행시키는것이 불가능합니다.
>> 하지만 코드 영역은 실행 권한이 존재하기 때문에
>> 사용자가 사용할 수 있는 프로그램의 코드를 실행
>> 가능한 것이죠.

## ASLR
>> Address Space Layout Randomization.
>> 원래 메모리 상에는 파일의 IMAGEBASE를 기반으로 스택영역, 코드영역, 힙영역, 
>> 라이브러리 영역, 운영체제 커널 영역 등이 선형으로 나열되어서 
>> 쉘코드를 이용한 공격으로 주소에 매우매우 쉽게 접근할 수 있었습니다.(32bit 환경)
>> 하지만 64비트 운영체제부터는 ASLR 기능으로 이런 영역들의 주소를
>> 실행 시에 랜덤하게 재배치합니다. 즉, 메모리 주소가 변하지 않는 점을
>> 이용해서 쉘 코드로 쉽게 exploit이 가능했던 취약점이 많이 없어졌습니다.
